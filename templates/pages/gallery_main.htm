{% extends 'layout/gallery.htm' %}
{% block g_body %}

{% macro item_box(item) %}  
  
  {% if item.getClass == 'Album' %}
    {% set beginlink = '?album=' %}        
    {% set imagesrc = 'albumthumbnail.php?w=200&h=140&image='~item.getPath %}
    {% set caption = item.getCaption %}     
    {% set link = '<a class="item_album" href = "'~beginlink~item.getPath~'">' %}     
  {% else %}
    {% set beginlink = 'loadDetail(\'?detail=' %}
    {% set endlink = '\');' %}
    {% set imagesrc = 'getimage.php?w=200&h=140&image='~item.getPath %}
    {% set caption = item.getCaption %}    
    {% set link = '<a class="item_photo" href = "#" onclick="'~beginlink~item.getPath~endlink~'">' %}    {# TODO: zmenit na no-js #}
  {% endif %}
 
{{link | raw}}
<div class='box_item '>        
    <div class='box_image'>
       <img src='{{imagesrc}}'  />
    </div>
    <div class='box_caption'>
       {{caption}} 
    </div>
</div>
</a>    
{% endmacro %}


<div id="detail_content"></div>
<script type="text/javascript" src="js/load_detail.js"></script>

<div id="header_panel">
<div id='album_title'>
<h1>{{gallery.getAlbum.caption}} :</h1>
</div>

<div id="userbar">
{%- if login -%}
<div class="userbar_item" id="username"><div>{{user.getDisplayName}} (<a href="logout.php">logout</a>)</div></div>
{% else %}
<div class="userbar_item" id="loginform">
<form action="" method="post">
  <input type="text" name="openid_identifier" id="openid_identifier"/>
  <script id="__openidselector" src="https://www.idselector.com/widget/button/1"></script>
  <input type="submit" value="Sign in" style="vertical-align:middle;"/>
</form>
</div>
{% endif %}
</div>

<div id="toolbar" {%- if not (login or gallery.getAlbum.parent) -%} class="hidden" {%endif%} >

<a href = "?album={{gallery.getAlbum.getParent.getPath}}" class="toolbutton {% if not gallery.getAlbum.parent %} hidden {%endif%}" id="parentDir">
<div class="toolbutton">
         <img src="images/toolbar/arrow.png" alt="../"/>
</div>
</a>
{% if user.isEditor %}
<a href="" class="toolbutton">
  <div class="toolbutton">
    <img src="images/toolbar/folder_add.png" alt="Add album"/>
  </div>
</a>
{%endif %}

{% if user.isAdmin %}
<a href="admin.php" class="toolbutton">
  <div class="toolbutton">
    <img src="images/toolbar/key.png" alt="Admin panel"/>
  </div>
</a>
{%endif %}


{%- if login -%}
<a href="index.php?settings" class="toolbutton">
  <div class="toolbutton">
    <img src="images/toolbar/cog.png" alt="Nastavenia"/>
  </div>
</a>
{% endif %}
</div>

</div>

<div id="album_plane">

{% for item in gallery.getItems %}      
  {{_self.item_box(item)}}
{% endfor %}

<div class="cleaner">&nbsp;</div>
</div>

{% endblock %}